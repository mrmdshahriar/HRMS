
@{
    ViewBag.Title = "PayrollCalculation";
}

<link href="~/Content/Assets/css/vertical-layout-light/style.css" rel="stylesheet" />
<link href="~/Content/Assets/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<link href="~/Content/Assets/css/Country.css" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />


<div class="container">

    <center>

        <h2>Payroll Calculation</h2>

        <input type="button" value="View Payroll" onclick="viewPayroll();" class="btn btn-primary" />

        <input type="button" value="Submit" onclick="viewPayroll();" class="btn btn-primary" />

        <input type="button" value="Process Payroll" onclick="ProcessPayroll();" class="btn btn-primary" />

        <input type="button" value="Download Sheet" onclick="DownloadSheetForEmployee();" class="btn btn-primary" />

    </center>

    <div style="height:530px;width:100%;overflow:auto;">


        <table class="table table-bordered table-responsive table-condensed" style="width:100%;height:100%;">
            <thead>
                <tr>  
                    <th style="text-align: center; background-color: lightblue;">Fixed Section Per Month</th>
                    <th style="text-align: center; background-color: lightgreen;">Total Salary</th>
                    <th style="text-align: center; background-color: lightyellow;">Deductions</th>
                    <th style="text-align: center; background-color: lightblue;">Gross Payable Salary</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <table>
                            <thead>
                                <tr>
                                    <th style="width:200px;">Emp ID</th>
                                    <th style="width:200px;">Emp Name</th>
                                    <th>Date of Joining</th>
                                    <th>Designation</th>
                                    <th>Department</th>
                                    <th>Basic Salary</th>
                                    <th>Allowance 1</th>
                                    <th>Allowance 2</th>
                                    <th>Allowance 3</th>
                                    <th>Total Salary</th>
                                    <th>Salary Month</th>
                                    <th>Total Payable Days</th>
                                    <th>Monthly Salary</th>
                                    <th>Normal OT Hours</th>
                                    <th>Normal OT1 Salary</th>
                                    <th>Weekend OT</th>
                                    <th>Weekend OT Salary</th>
                                    <th>Public Holiday OT Hours</th>
                                    <th>Public Holiday OT Salary</th>
                                </tr>
                            </thead>
                            <tbody id="FixedSectionPerMonth">
                            </tbody>
                        </table>
                    </td>
                    <td>
                        <table>
                            <thead>
                                <tr>
                                    <th>Monthly Salary</th>
                                    <th>Normal OT Hours</th>
                                    <th>Normal OT1 Salary</th>
                                    <th>Weekend OT</th>
                                    <th>Weekend OT Salary</th>
                                    <th>Public Holiday OT Hours</th>
                                    <th>Public Holiday OT Salary</th>
                                    <th>OT4</th>
                                    <th>OT5</th>
                                    <th>Arrears</th>
                                    <th>Bonus</th>
                                    <th>Total Salary</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                    </td>
                    <td>
                        <table>
                            <thead>
                                <tr>
                                    <th>Deductions</th>
                                    <th>Advance</th>
                                    <th>Loan</th>
                                    <th>Income Tax</th>
                                    <th>EOBI</th>
                                    <th>Provident Fund</th>
                                </tr>
                            </thead>
                            <tbody id="Deductions">
                            </tbody>
                        </table>
                    </td>
                    <td>

                        <h1>Demo</h1>

                    </td>
                </tr>
            </tbody>
        </table>


    </div>

</div>

@*Modal*@
<div class="modal fade" id="DownloadSheet" tabindex="-1" role="dialog" aria-labelledby="CountryModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="display:flex;justify-content:center;align-items:center;">
        <div class="modal-content" style="width:1400px;">
            <div class="modal-header modal-header">
                <h5 class="modal-title" style="color:white">Salary Sheet Details</h5>
                <button type="button" class="close" data-bs-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">

                @*<div class="row">*@

                    <div style="height: 600px; width: 100%; overflow: auto;">

                        <table class="table table-bordered table-responsive table-condensed" style="width:100%;height:100%;">
                            <thead>
                                <tr>
                                    <th style="text-align: center; background-color: lightblue;">Fixed Section Per Month</th>
                                    <th style="text-align: center; background-color: lightgreen;">Total Salary</th>
                                    <th style="text-align: center; background-color: lightyellow;">Deductions</th>
                                    <th style="text-align: center; background-color: lightblue;">Gross Payable Salary</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th><input type="checkbox" id="checkAll" onchange="SelectAll();" />Select All</th>
                                                    <th style="width:200px;">Emp ID</th>
                                                    <th style="width:200px;">Emp Name</th>
                                                    <th>Date of Joining</th>
                                                    <th>Designation</th>
                                                    <th>Department</th>
                                                    <th>Basic Salary</th>
                                                    <th>Allowance 1</th>
                                                    <th>Allowance 2</th>
                                                    <th>Allowance 3</th>
                                                    <th>Total Salary</th>
                                                    <th>Salary Month</th>
                                                    <th>Total Payable Days</th>
                                                    <th>Monthly Salary</th>
                                                </tr>
                                            </thead>
                                            <tbody id="FixedSectionPerMonthModal">
                                            </tbody>
                                        </table>
                                    </td>
                                    <td>
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Monthly Salary</th>
                                                    <th>Normal OT Hours</th>
                                                    <th>Normal OT1 Salary</th>
                                                    <th>Weekend OT</th>
                                                    <th>Weekend OT Salary</th>
                                                    <th>Public Holiday OT Hours</th>
                                                    <th>Public Holiday OT Salary</th>
                                                    <th>OT4</th>
                                                    <th>OT5</th>
                                                    <th>Arrears</th>
                                                    <th>Bonus</th>
                                                    <th>Total Salary</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>

                                    </td>
                                    <td>
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Deductions</th>
                                                    <th>Advance</th>
                                                    <th>Loan</th>
                                                    <th>Income Tax</th>
                                                    <th>EOBI</th>
                                                    <th>Provident Fund</th>
                                                </tr>
                                            </thead>
                                            <tbody id="DeductionsModal">
                                            </tbody>
                                        </table>
                                    </td>
                                    <td>

                                        <h1>Demo</h1>

                                    </td>
                                </tr>
                            </tbody>
                        </table>

                    </div>

                @*</div>*@

            </div>
            <div class="modal-footer" id="divAddTask">
                <button type="button" class="btn btn-primary" id="Process" onclick="Process();"><i class="fas fa-plus tm-fa-plus"></i>Process</button>
            </div>
        </div>
    </div>
</div>

@*Modal*@
<div class="modal fade" id="DownloadSheetForEmployee" tabindex="-1" role="dialog" aria-labelledby="CountryModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="display:flex;justify-content:center;align-items:center;">
        <div class="modal-content" style="height: 950px; width: 1400px;">
            <div class="modal-header modal-header" style="padding-top:0px;padding-bottom:0px;padding-left:0px;">
                <div style="width:80px;height:50px;overflow:hidden;"><img src="~/Logo.jpg" style="width:50px;height:50px;zoom:2;position:relative;top:-8px;left:-7px;" /></div>
                <div style="width:100%;text-align:center;"><h5 class="modal-title" style="color:white">Salary Slip</h5></div>
                <button type="button" class="close" data-bs-dismiss="modal" style="margin-top:-23px;">&times;</button>
            </div>
            <div class="modal-body" style="width:1200px;">
                        <div style="height:100%; width: 100%; overflow: auto;padding:0;">
                            <div style="text-align:center;font-size:25px;font-weight:bold;background-color:yellow;">Salary Slip</div>
                            <table class="table table-bordered">

                                <tr>
                                    <th style="width:25%;">Employee ID</th>
                                    <th style="width:25%;"></th>
                                    <th style="width:25%;">Employee Name</th>
                                    <th style="width:25%;"></th>
                                </tr>
                                <tr>
                                    <th>Designation</th>
                                    <th></th>
                                    <th>Department</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Date of Joining</th>
                                    <th></th>
                                    <th>Salary Month</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Basic Salary</th>
                                    <th></th>
                                    <th>Allowance 1</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Allowance 2</th>
                                    <th></th>
                                    <th>Other Payment</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Total Monthly Salary</th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Present Days</th>
                                    <th></th>
                                    <th>Absent Days</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Bank Name</th>
                                    <th></th>
                                    <th>Account Number</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th colspan="4" style="background-color: yellow; text-align: center;">*If applicable for Overtime add in OT colums and hours</th>
                                </tr>
                                <tr style="background-color: yellow;">
                                    <th>Normal OT hours</th>
                                    <th></th>
                                    <th>Fri OT hours</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th colspan="4" style="background-color:lightgrey; text-align:center;">CALCULATION</th>
                                </tr>
                                <tr>
                                    <th colspan="2" style="text-align:center;">Salary (A)</th>
                                    <th colspan="2" style="text-align:center;">Deductions (B)</th>
                                </tr>
                                <tr>
                                    <th>Monthly Salary</th>
                                    <th></th>
                                    <th>Income Tax</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Normal OT</th>
                                    <th></th>
                                    <th>Loan</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Friday OT</th>
                                    <th></th>
                                    <th>EOBI</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Bonus</th>
                                    <th></th>
                                    <th>Provident</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th>Advance</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th>Other Deduction</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th>Total Salary</th>
                                    <th></th>
                                    <th>Gross Salary (A-B)</th>
                                    <th></th>
                                </tr>

                            </table>
                        </div>

            </div>
            <div class="modal-footer" id="divAddTask">
                <button type="button" class="btn btn-primary" id="Process" onclick="Download();">Download</button>
            </div>
        </div>
    </div>
</div>

    <script>


        function Process() {
            debugger;

        }

        function Download() {
            debugger;

        }

        function SelectAll() {
            debugger;

            var checkAll = $("#checkAll").prop("checked");

            if (checkAll) {
                $(".checkRow").prop("checked", true);
            }
            else {
                $(".checkRow").prop("checked", false);
            }
        }

        function RemoveCheck() {
            debugger;

            $("#checkAll").prop("checked", false);

            if ($(".checkRow").filter(":checked").length == $(".checkRow").length) {

                $("#checkAll").prop("checked", true);
            }
        }

       
        function ProcessPayroll() {
            debugger;

            var str = '';

            $.ajax({

                type: "GET",
                url: "/PayRoll/GetPayrollCalculationTableData",
                success: function (data) {
                    debugger;

                    $.each(data, function (index, obj) {

                        str += '<tr>' +
                            '<td>' +
                            '<input type="checkbox" class="checkRow" onchange="RemoveCheck();"/>' +
                            '</td>' +
                            '<td>' +
                            obj.EmployeeId +
                            '</td>' +
                            '<td>' +
                            obj.EmployeeName +
                            '</td>' +
                            '<td>' +
                            obj.DateofJoining +
                            '</td>' +
                            '<td>' +
                            obj.Designation +
                            '</td>' +
                            '<td>' +
                            obj.Department +
                            '</td>' +
                            '<td>' +
                            obj.BasicSalary +
                            '</td>' +
                            '<td>' +
                            obj.Allowances1 +
                            '</td>' +
                            '<td>' +
                            obj.Allowances2 +
                            '</td>' +
                            '<td>' +
                            obj.Allowances3 +
                            '</td>' +
                            '<td>' +
                            (obj.BasicSalary + obj.TotalAmount1 + obj.TotalAmount2 + obj.TotalAmount3) +
                            '</td>' +
                            '<td>' +
                             obj.SalaryMonth +
                            '</td>' +
                            '<td>' +
                            obj.TotalPayableDays +
                            '</td>' +
                            '</tr>';
                    });

                    $("#FixedSectionPerMonthModal").html(str);

                    var str2 = '';

                    $.ajax({

                        type: "GET",
                        url: "/PayRoll/GetPayrollCalculationDeductionData",
                        success: function (data) {
                            debugger;

                            $.each(data, function (index, obj) {

                                str2 += '<tr>' +
                                    '<td>' +
                                    obj.Deductions +
                                    '</td>' +
                                    '<td>' +
                                    obj.Advance +
                                    '</td>' +
                                    '<td>' +
                                    obj.Loan +
                                    '</td>' +
                                    '<td>' +
                                    obj.IncomeTax +
                                    '</td>' +
                                    '<td>' +
                                    obj.EOBI +
                                    '</td>' +
                                    '<td>' +
                                    obj.ProvidentFund +
                                    '</td>' +
                                    '</tr>';
                            });

                            $("#DeductionsModal").html(str2);

                        }
                    });
                },
                error: function (data) {
                    console.log(data);
                }
            });

            $("#checkAll").prop("checked", false);

            $("#DownloadSheet").modal('show');
        }



        function DownloadSheetForEmployee() {
            debugger;

            $("#DownloadSheetForEmployee").modal('show');

        }


        function viewPayroll() {
            debugger;

            var currentDate = new Date();

            var CalendarDaysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();

            var str = '';

            $.ajax({

                type: "GET",
                url: "/PayRoll/GetPayrollCalculationTableData",
                success: function (data) {
                    debugger;

                    $.each(data, function (index, obj) {

                        str += '<tr>' +
                            '<td>' +
                            obj.EmployeeId +
                            '</td>' +
                            '<td>' +
                            obj.EmployeeName +
                            '</td>' +
                            '<td>' +
                            obj.DateofJoining +
                            '</td>' +
                            '<td>' +
                            obj.Designation +
                            '</td>' +
                            '<td>' +
                            obj.Department +
                            '</td>' +
                            '<td>' +
                            obj.BasicSalary +
                            '</td>' +
                            '<td>' +
                            obj.Allowances1 +
                            '</td>' +
                            '<td>' +
                            obj.Allowances2 +
                            '</td>' +
                            '<td>' +
                            obj.Allowances3 +
                            '</td>' +
                            '<td>' +
                            (obj.BasicSalary + obj.TotalAmount1 + obj.TotalAmount2 + obj.TotalAmount3) +
                            '</td>' +
                            '<td>' +
                            obj.SalaryMonth +
                            '</td>' +
                            '<td>' +
                            obj.TotalPayableDays +
                            '</td>' +
                            '<td>' +
                            (((obj.BasicSalary + obj.TotalAmount1 + obj.TotalAmount2 + obj.TotalAmount3) / CalendarDaysInMonth) * obj.TotalPayableDays).toFixed(2) +
                            '</td>' +
                            '<td>' +
                            obj.NormalOTHours +
                            '</td>' +
                            '<td>' +
                            ((((obj.BasicSalary + obj.TotalAmount1 + obj.TotalAmount2 + obj.TotalAmount3) / 30) / 8) * obj.NormalOTHours).toFixed(2) +
                            '</td>' +
                            '<td>' +
                            obj.WeekendOTHours +
                            '</td>' +
                            '<td>' +
                            ((((obj.BasicSalary + obj.TotalAmount1 + obj.TotalAmount2 + obj.TotalAmount3) / 30) / 8) * obj.WeekendOTHours).toFixed(2) +
                            '</td>' +
                            '<td>' +
                            obj.PublicHolidaysOTHours +
                            '</td>' +
                            '<td>' +
                            ((((obj.BasicSalary + obj.TotalAmount1 + obj.TotalAmount2 + obj.TotalAmount3) / 30) / 8) * obj.PublicHolidaysOTHours).toFixed(2) +
                            '</td>' +
                            '</tr>';
                    });

                    $("#FixedSectionPerMonth").html(str);

                    DeductionsAndTaxCalculations();
                },
                error: function (data) {
                    console.log(data);
                }
            });
        }


        function DeductionsAndTaxCalculations() {
            debugger;

            var str2 = '';

            $.ajax({

                type: "GET",
                url: "/PayRoll/GetPayrollCalculationDeductionData",
                success: function (data) {
                    debugger;

                    $.each(data, function (index, obj) {

                        str2 += '<tr>' +
                            '<td>' +
                            obj.Deductions +
                            '</td>' +
                            '<td>' +
                            obj.Advance +
                            '</td>' +
                            '<td>' +
                            obj.Loan +
                            '</td>' +
                            '<td>' +
                            obj.IncomeTax +
                            '</td>' +
                            '<td>' +
                            obj.EOBI +
                            '</td>' +
                            '<td>' +
                            obj.ProvidentFund +
                            '</td>' +
                            '</tr>';
                    });

                    $("#Deductions").html(str2);

                }
            });

        }

    </script>
